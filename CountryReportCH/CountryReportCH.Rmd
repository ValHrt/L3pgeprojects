---
title: "Country Report Switzerland"
author: "Valentin"
date: "18/01/2020"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Switzerland population map by canton

```{r}
library(sf)
library(ggplot2)
library(tmap)
library(tmaptools)
library(leaflet)
library(dplyr)
library(tidyr)
```

```{r}
library(readxl)
CHdatamap <- read_excel("~/L3pgeprojects/CountryReportCH/MapCH/CHdatamap.xlsx", 
    sheet = "2018", col_types = c("text", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric"))
```

```{r}
CHdatamap1 <- tidyr::drop_na(CHdatamap)
```

```{r}
CHdatamap1 <- rename(CHdatamap1, NAME_1=...1)
```

### Supprimer les lignes depuis Excel

```{r}
CHdatamap2 <- ifelse(CHdatamap1$Total >= 1 & CHdatamap1$Total <= 50000, "1-50000", ifelse(CHdatamap1$Total >= 50001 & CHdatamap1$Total <= 100000, "50001-100000", ifelse(CHdatamap1$Total >= 100001 & CHdatamap1$Total <= 200000, "100001-200000", ifelse(CHdatamap1$Total >= 200001 & CHdatamap1$Total <= 300000, "200001-300000", ifelse(CHdatamap1$Total >= 300001 & CHdatamap1$Total <= 400000, "300001-400000", ifelse(CHdatamap1$Total >= 400001 & CHdatamap1$Total <= 500000, "400001-500000", ifelse(CHdatamap1$Total >= 500001 & CHdatamap1$Total <= 700000, "500001-700000", ifelse(CHdatamap1$Total >= 700001 & CHdatamap1$Total <= 1000000, "700001-1000000", ifelse(CHdatamap1$Total >= 1000000 & CHdatamap1$Total <= 1500000, "1000001-1500000", ifelse(CHdatamap1$Total >= 1500001, "1500000+", NA))))))))))
```

```{r}
cut(CHdatamap1$Total, breaks=c(0, 50000, 100000, 200000, 300000, 400000, 500000, 700000, 1000000, 1500000, Inf), labels=c("0-50000", "50001-100000", "100001-200000", "200001-300000", "300001-400000", "400001-500000", "500001-700000", "700001-1000000", "1000001-1500000", "1500000+"))
```

```{r}
mylabels <- c("0-50000", "50001-100000", "100001-200000", "200001-300000", "300001-400000", "400001-500000", "500001-700000", "700001-1000000", "1000001-1500000", "1500000+")
```

```{r}
CHdatamap1$Population <- base::cut(CHdatamap1$Total,
                        breaks = c(0, 50000, 100000, 200000, 300000, 400000, 500000, 700000, 1000000, 1500000, 2000000), 
                        labels = mylabels, right = F, ordered_result = T)
```

```{r}
myCHmap <- st_read("~/L3pgeprojects/CountryReportCH/MapCH/CHE_adm/CHE_adm1.shp", stringsAsFactors = FALSE)

datamap <- inner_join(myCHmap, CHdatamap1)

tm_shape(datamap) +
tm_polygons("Population", id = "NAME_1", palette = "Reds")+ 

tmap_mode("view")
DensityMap <- tmap_last()


tmap_save(DensityMap, "PopulationMapCH.html")
```

### Mettre le texte utilisÃ© dans le FlexDashboard


# Switzerland main economic indicators

## Analysis of the GDP

```{r search indicator GDP}
library(WDI)
CHGDP <-WDI(indicator = "NY.GDP.MKTP.KD.ZG",
country = c("CH"),
                   start = 1971,
                   end = 2018)
```

```{r delete iso2c column}
CHGDP$iso2c <- NULL
```

```{r graphic about Switzerland GDP growth}
library(ggplot2)
 ggplot(CHGDP) +
 aes(x = year, y = NY.GDP.MKTP.KD.ZG) +
 geom_line(size = 1L, colour = "#0c4c8a") +
 labs(y = "Gdp growth in %", title = "Switzerland GDP growth in % (1971-2018)", caption = "Source: SKEMA Quantum Studio") +
 theme_minimal()
```

```{r summary Switzerland GDP}
CHmeangdp <- summary(CHGDP$NY.GDP.MKTP.KD.ZG) 
CHmeangdp
```

### Conclusion about the GDP growth in %

As we can see on the graph, the Switzerland GDP growth is sometimes under 0, but the most of the time, it's higher than 0. To better understand these data, i have choosen to compute the mean (1,68) and the median (1,82) of the GDP growth on the period 1971 - 2018.
As we can see on the graphic, there is an important decrease in 1975 due to the first oil crisis.

## Comparison with three european countries (France, Italy, Germany)

```{r compare countries GDP}
comparecountries <-WDI(indicator = "NY.GDP.MKTP.KD.ZG",
country = c("CH", "DE", "FRA", "IT"),
                   start = 1971,
                   end = 2018)
```

### Comparison of the data between the 4 countries

```{r summary of the 4 countries}
library(dplyr)
comparecountries %>% group_by(country) %>% summarise(mean_gdp = mean(NY.GDP.MKTP.KD.ZG), max_gdp = max(NY.GDP.MKTP.KD.ZG), min_gdp = min(NY.GDP.MKTP.KD.ZG), median_gdp = median(NY.GDP.MKTP.KD.ZG))
```


### Conclusion about the comparison 

As we can see, Switzerland doesn't have the best results in terms of the variation of his GDP. In fact, Switzerland has the worst results compared to this others countries.
It'll be interesting to understand why Switzerland has a better economy than these 3 countries even if the results about the variation of his gdp are less good than his neighbours.

## Analysis of the GDP per capita of Switzerland

```{r Switzerland GDP per capita}
CHGdpPerCapita<- WDI(indicator = "NY.GDP.PCAP.PP.CD",
country = c("CH"),
                   start = 1990,  #the data start in 1990 for this information
                   end = 2018)
```

```{r Switzerland Gdp per capita evolution graphic}
ggplot(CHGdpPerCapita) +
 aes(x = year, y = NY.GDP.PCAP.PP.CD) +
 geom_line(size = 1L, colour = "#0c4c8a") +
 labs(y = "Gdp per capita", title = "Switzerland Gdp per capita evolution (in $ constant)", caption = "Source: SKEMA Quantum Studio") +
 theme_minimal()
```

### Conclusion about the evolution of the GDP per capita of Switzerland

We can see that the GDP per capita increase during this period, he was at 27594.63 in 1990 and at 68060.94 in 2018 (146,6% increase). It'll be now interesting to compare with the three others countries to see if Switzerland is better in this category.

## Comparison with three european countries (France, Italy, Germany)

```{r Compare countries GDP per capita}
GdpPerCapitaComparison <- WDI(indicator = "NY.GDP.PCAP.PP.CD",
country = c("CH", "DE", "FRA", "IT"),
                   start = 1990,
                   end = 2018)
```

```{r Comparison graphic about GDP per capita}
ggplot(GdpPerCapitaComparison) +
 aes(x = year, y = NY.GDP.PCAP.PP.CD, colour = country) +
 geom_line(size = 1L) +
 scale_color_hue() +
 labs(y = "GDP per capita", title = "Comparison GDP per capita", caption = "Source: SKEMA Quantum Studio") +
 theme_minimal()
```

### Conclusion about the comparison 

Switzerland seems to be far away from his neighbours regarding the gdp per capita. Germany is in the second place with 53074.54 in 2018 (28% less than Switzerland), France in the third place with 45342.40 in 2018 (50% less than Switzerland).
The conclusion of this analysis is that Switzerland is better when speaking about economic health into an individual citizens perspective.

## How Switzerland deals with unemployment?

```{r Unemployment advanced education}
CHUnemploymentadvancededucation <- WDI(indicator = "SL.UEM.ADVN.ZS", #Unemployment with advanced education (% of total labor force with advanced education)
country = c("CH"),
                   start = 1998,
                   end = 2018)
```

```{r Renaming column Advanced_Education}
base::colnames(CHUnemploymentadvancededucation)[colnames(CHUnemploymentadvancededucation)=="SL.UEM.ADVN.ZS"] <- "Advanced_Education"
```


```{r Unemployment intermediate education}
CHUnemploymentintermediateeducation <- WDI(indicator = "SL.UEM.INTM.ZS", #Unemployment with intermediate education (% of total labor force with intermediate education)
country = c("CH"),
                   start = 1998,
                   end = 2018)
```

```{r Renaming column Intermediate_Education}
base::colnames(CHUnemploymentintermediateeducation)[colnames(CHUnemploymentintermediateeducation)=="SL.UEM.INTM.ZS"] <- "Intermediate_Education"
```


```{r Unemployment basic education}
CHUnemploymentbasiceducation <- WDI(indicator = "SL.UEM.BASC.ZS", #Unemployment with basic education (% of total labor force with basic education)
country = c("CH"),
                   start = 1998,
                   end = 2018)
```

```{r Renaming column Basic_Education}
base::colnames(CHUnemploymentbasiceducation)[colnames(CHUnemploymentbasiceducation)=="SL.UEM.BASC.ZS"] <- "Basic_Education"
```


```{r First left-join}
library(dplyr)
CHjoin1 <- left_join(CHUnemploymentadvancededucation, CHUnemploymentintermediateeducation, by="year") 
```

```{r Second left-join}
CHjoin2 <- left_join(CHjoin1, CHUnemploymentbasiceducation, by="year")
```

```{r Delete some columns}
CHjoin2$iso2c.y <- NULL
CHjoin2$iso2c <-  NULL
CHjoin2$country.y <- NULL
CHjoin2$country <- NULL
```

```{r Re-arrange columns}
CHjoin2 <- CHjoin2[c(1,2,4,3,5,6)]
```

## Graphic of the comparison about unemployment rate by education level

```{r Graphic about unemployment rate by education level}
library(tidyr)

CHjoin2 <- gather(
  data = CHjoin2,
  key = TYPE,
  value = VAL,
  Advanced_Education, Intermediate_Education, Basic_Education)

library(ggplot2)

ggplot(
  CHjoin2,
  aes(x = year, y = VAL, color = TYPE)
) +
  labs(y = "Unemployment rate", title = "Unemployment rate by education level", caption = "Source: SKEMA Quantum Studio") +
geom_line()
```


### Conclusion about unemployment rate (TO DO)

## Unemployment comparison with France, Germany and Italy

```{r Unemployment with advanced education comparison}
UAEcomparison<- WDI(indicator = "SL.UEM.ADVN.ZS", #Unemployment with advanced education (% of total labor force with advanced education)
country = c("CH", "DE", "FRA", "IT"),
                   start = 2000,
                   end = 2018)
```

```{r Renaming column Advanced_Education comparison}
base::colnames(UAEcomparison)[colnames(UAEcomparison)=="SL.UEM.ADVN.ZS"] <- "Advanced_EducationC"
```

```{r Unemployment intermediate education comparison}
UIEcomparison<- WDI(indicator = "SL.UEM.INTM.ZS", #Unemployment with intermediate education (% of total labor force with advanced education)
country = c("CH", "DE", "FRA", "IT"),
                   start = 2000,
                   end = 2018)
```

```{r Renaming column Intermediate_Education comparison}
base::colnames(UIEcomparison)[colnames(UIEcomparison)=="SL.UEM.INTM.ZS"] <- "Intermediate_EducationC"
```

```{r Unemployment basic education comparison}
UBEcomparison <- WDI(indicator = "SL.UEM.BASC.ZS", #Unemployment with basic education (% of total labor force with advanced education)
country = c("CH", "DE", "FRA", "IT"),
                   start = 2000,
                   end = 2018)
```

```{r Renaming column Basic_Education comparison}
base::colnames(UBEcomparison)[colnames(UBEcomparison)=="SL.UEM.BASC.ZS"] <- "Basic_EducationC"
```

```{r Combining columns comparison}
library(dplyr)
UCjoin <- bind_cols(UAEcomparison, UIEcomparison, UBEcomparison)
```

```{r Delete some columns comparison}
UCjoin$iso2c <- NULL
UCjoin$iso2c1 <- NULL
UCjoin$country1 <- NULL
UCjoin$year1 <- NULL
UCjoin$iso2c2 <- NULL
UCjoin$country2 <- NULL
UCjoin$year2 <- NULL
```

```{r Re-arrange columns comparison}
UCjoin <- UCjoin[c(1,3,2,4,5)]
```

### Graphic about unemployment by education level between 4 european countries

```{r Gather data about unemployment comparison}
library(tidyr)

UCjoinTest <- gather(data = UCjoin, key = TYPE, value = VAL, Advanced_EducationC, Intermediate_EducationC, Basic_EducationC)
```

```{r Graphic about unemployment rate by education level comparison}
qplot(data = UCjoinTest, y = VAL, x = year, color = TYPE, geom = "line") + 
  labs(y = "Unemployment rate in %", title = "Unemployment rate by education level", caption = "Source: SKEMA Quantum Studio") +
  facet_wrap(~ country) +
  theme_linedraw()
```


### Conclusion about unemployment rate comparison (TO DO)


## What are Switzerland's sources of income?

```{r Merchandise exports to high-income economies}
CHExports <- WDI(indicator = "TX.VAL.MRCH.HI.ZS", #Merchandise exports to high-income economies (% of total merchandise exports)
country = c("CH"),
                   start = 1971,
                   end = 2018)
```



```{r Merchandise exports to high-income economies graphic}
library(ggplot2)
ggplot(CHExports) +
 aes(x = year, y = TX.VAL.MRCH.HI.ZS) +
 geom_line(size = 1L, colour = "#0c4c8a") +
 labs(y = "Merchandise Exports", title = "Merchandise exports to high-income economies (% of total 
      merchandise exports)", caption = "Source: SKEMA Quantum Studio") +
 theme_minimal()
```



```{r Merchandise imports from low- and middle-income economies}
CHImports <- WDI(indicator = "TM.VAL.MRCH.OR.ZS", #Merchandise imports from low- and middle-income economies outside region (% of total merchandise imports)
country = c("CH"),
                   start = 1971,
                   end = 2018)
```

```{r Merchandise imports from low- and middle-income economies graphic}
library(ggplot2)
ggplot(CHImports) +
 aes(x = year, y = TM.VAL.MRCH.OR.ZS) +
 geom_line(size = 1L, colour = "#0c4c8b") +
 labs(y = "Imports from low_middle economies", title = "Merchandise imports from low- and middle-income economies", caption = "Source: SKEMA Quantum Studio") +
 theme_minimal()
```

## Crossing data between imports/exports

```{r crossing board import export}
library(dplyr)
ImportExport <- bind_cols(CHExports, CHImports)
```

```{r}
base::colnames(ImportExport)[colnames(ImportExport)=="TX.VAL.MRCH.HI.ZS"] <- "ExportsToHighEconomies"
base::colnames(ImportExport)[colnames(ImportExport)=="TM.VAL.MRCH.OR.ZS"] <- "ImportsFromLowEconomies"
```


```{r}
library(tidyr)

CHImportExport <- gather(data = ImportExport, key = TYPE, value = VAL, ExportsToHighEconomies, ImportsFromLowEconomies)
```

```{r Comparison graphic about imports and exports}
library(ggplot2)
ggplot(CHImportExport) +
 aes(x = year, y = VAL, colour = TYPE) +
 geom_line(size = 1L) +
  geom_vline(aes(xintercept = 2010), linetype=2, colour = "black", size = 1) +
  geom_vline(aes(xintercept = 2017), linetype=2, colour = "black", size = 1) +
 scale_color_hue() +
 labs(y = "In % of total trades", title = "Comparison about imports to high economies and 
      exports from low/middle economies ", caption = "Source: SKEMA Quantum Studio") +
 theme_gray()
```

### Conclusion about Switzerland imports and exports partners

We can see that the Switzerland imports a bit (19,24%) from low / middle economies in 2017 but this is really increasing since 2010. About the exports, Switzerland exports a lot to high-income economies (75,15%) in 2017 but this is decreasing since 2010.
As a conclusion, we can say that Switzerland tend to import more from low / middle economies but also to export more to these economies. However, the most of exports / imports of Switzerland are made with high-income economies but the low / middle economies increase their parts during last decade.

## Social progress index in Switzerland compared to France, Italy and Germany

```{r Library call}
library(spiR)
library(kableExtra)
library(ggplot2)
library(dplyr)
```

```{r Generate SPI data}
SPIc <- sqs_spi_data(country = c("CHE", "FRA", "DEU", "ITA"), 
                       year = c("2014","2015","2016", "2017", "2018", "2019"), 
                       indicators = "SPI")
```

```{r Convert value to numeric SPI}
SPIc$value <- as.numeric(SPIc$value)
```

```{r Generate new board SPI}
kable(SPIc)%>%
scroll_box(width = "100%", height = "200px")
```

```{r Generate SPI graphic}
ggplot(data = SPIc, aes(x = var_year, y = value, color = countryName)) + 
  geom_line() +
  theme_grey() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  labs(title = "Social Progress Index of 4 different european countries since 2014",
       x = "Years",
       y = "Social Progress Index Score",
       colour = "Countries",
       caption = "Source: SKEMA Quantum Studio")
```

### Conclusion about comparison of SPI between Switzerland, France, Italy and Germany

### TestTestTest

```{r}
ExpenditureEducationC <- WDI(indicator = "SE.XPD.TOTL.GD.ZS", #Government expenditure on education, total (% of GDP)
country = c("CH", "FRA", "DE", "ITA"),
                   start = 1996,
                   end = 2016)
ExpenditureEducationC <- dplyr::rename(ExpenditureEducationC, Government_Expenditure = SE.XPD.TOTL.GD.ZS)
```

```{r}
GDPComparison <- WDI(indicator = "NY.GDP.MKTP.CD", #GDP
country = c("CH", "FRA", "DE", "ITA"),
                   start = 1996,
                   end = 2016)
GDPComparison <- dplyr::rename(GDPComparison, GDP = NY.GDP.MKTP.CD)
```

```{r}
library(dplyr)
PlotEducationGDP <- bind_cols(ExpenditureEducationC, GDPComparison)
```

```{r}
library(plotly)
DynGraphPlotEducationGDP <- ggplot(PlotEducationGDP, aes(year, Government_Expenditure, color = country)) +
  geom_point(aes(size = GDP, frame = year)) +
  scale_x_log10() +
  hrbrthemes::theme_modern_rc() +
  labs(y = "Government Expenditure in % of GDP", title = "Expenditure on education in % of GDP")
DynGraphPlotEducationGDP <- ggplotly(DynGraphPlotEducationGDP)
DynGraphPlotEducationGDP 
```

```{r}
library(rdbnomics)
BalanceTransactionsC <- rdb(ids = c('AMECO/UBCA/CHE.1.0.0.0.UBCA', "AMECO/UBCA/FRA.1.0.0.0.UBCA", "AMECO/UBCA/ITA.1.0.0.0.UBCA", "AMECO/UBCA/DEU.1.0.0.0.UBCA")) %>%
  filter(!is.na(value))
BalanceTransactionsC <- rename(BalanceTransactionsC, country = series_name)
```

```{r}
ggplot(BalanceTransactionsC, aes(x = period, y = value, color = country)) +
  geom_line(size = 1) + 
  theme_dark() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "Balance transaction", title = "Balance on current transactions with the rest of the world")
```

```{r Consumer Price Index, Base 2010=100}
CPIc<- rdb(ids = c('BIS/long_cpi/A.CH.628', "BIS/long_cpi/A.FR.628", "BIS/long_cpi/A.IT.628", "BIS/long_cpi/A.DE.628")) %>%
  filter(!is.na(value))
CPIc <- rename(CPIc, Country = series_name)
```

```{r}
ggplot(CPIc, aes(x = period, y = value, color = Country)) +
  geom_line(size = 1) + 
  theme_dark() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "Consumer Price Index", title = "CPI comparison")
```







