---
title: "Country Report Switzerland"
author: "Valentin"
date: "18/01/2020"
output:
  html_document: 
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# **Population map by canton**

```{r, include=FALSE}
library(sf)
library(ggplot2)
library(tmap)
library(tmaptools)
library(leaflet)
library(dplyr)
library(tidyr)
library(rdbnomics)
```

```{r, include=FALSE}
library(readxl)
CHdatamap <- read_excel("~/L3pgeprojects/CountryReportCH/MapCH/CHdatamap.xlsx", 
    sheet = "2018", col_types = c("text", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric"))
```

```{r, include=FALSE}
CHdatamap1 <- tidyr::drop_na(CHdatamap)
```

```{r, include=FALSE}
CHdatamap1 <- rename(CHdatamap1, NAME_1=...1)
```

```{r, include=FALSE}
CHdatamap2 <- ifelse(CHdatamap1$Total >= 1 & CHdatamap1$Total <= 50000, "1-50000", ifelse(CHdatamap1$Total >= 50001 & CHdatamap1$Total <= 100000, "50001-100000", ifelse(CHdatamap1$Total >= 100001 & CHdatamap1$Total <= 200000, "100001-200000", ifelse(CHdatamap1$Total >= 200001 & CHdatamap1$Total <= 300000, "200001-300000", ifelse(CHdatamap1$Total >= 300001 & CHdatamap1$Total <= 400000, "300001-400000", ifelse(CHdatamap1$Total >= 400001 & CHdatamap1$Total <= 500000, "400001-500000", ifelse(CHdatamap1$Total >= 500001 & CHdatamap1$Total <= 700000, "500001-700000", ifelse(CHdatamap1$Total >= 700001 & CHdatamap1$Total <= 1000000, "700001-1000000", ifelse(CHdatamap1$Total >= 1000000 & CHdatamap1$Total <= 1500000, "1000001-1500000", ifelse(CHdatamap1$Total >= 1500001, "1500000+", NA))))))))))
```

```{r, include=FALSE}
cut(CHdatamap1$Total, breaks=c(0, 50000, 100000, 200000, 300000, 400000, 500000, 700000, 1000000, 1500000, Inf), labels=c("0-50000", "50001-100000", "100001-200000", "200001-300000", "300001-400000", "400001-500000", "500001-700000", "700001-1000000", "1000001-1500000", "1500000+"))
```

```{r, include=FALSE}
mylabels <- c("0-50000", "50001-100000", "100001-200000", "200001-300000", "300001-400000", "400001-500000", "500001-700000", "700001-1000000", "1000001-1500000", "1500000+")
```

```{r, include=FALSE}
CHdatamap1$Population <- base::cut(CHdatamap1$Total,
                        breaks = c(0, 50000, 100000, 200000, 300000, 400000, 500000, 700000, 1000000, 1500000, 2000000), 
                        labels = mylabels, right = F, ordered_result = T)
```

<style>
.html-widget {
    margin: auto;
}
</style>

```{r leaflet, message=FALSE, warning=FALSE, fig.align="center"}
myCHmap <- st_read("~/L3pgeprojects/CountryReportCH/MapCH/CHE_adm/CHE_adm1.shp", stringsAsFactors = FALSE)

datamap <- inner_join(myCHmap, CHdatamap1)

tm_shape(datamap) +
tm_polygons("Population", id = "NAME_1", palette = "Reds")+ 

tmap_mode("view")
DensityMap <- tmap_last()


tmap_save(DensityMap, "PopulationMapCH.html")
```

### Which cantons are the more (or less) populated?

Here is a map of *Switzerland* divided into **cantons**, showing the **total population** of each canton in **2018**.
The canton of *Zurich* has the most inhabitants (**1520968 inhabitants**) and the canton of *Appenzell Innerrhoden* the least with only **16145 inhabitants**.

*Switzerland* had a population of **8.57 million** inhabitants in 2019.


# **Main economic indicators**

## Analysis of the GDP growth in %

```{r search indicator GDP, include=FALSE}
library(WDI)
CHGDP <-WDI(indicator = "NY.GDP.MKTP.KD.ZG",
country = c("CH"),
                   start = 1971,
                   end = 2018)
```

```{r delete iso2c column, include=FALSE}
CHGDP$iso2c <- NULL
```

```{r graphic about Switzerland GDP growth, fig.align='center'}
library(ggplot2)
 ggplot(CHGDP) +
 aes(x = year, y = NY.GDP.MKTP.KD.ZG) +
 geom_line(size = 1L, colour = "#0c4c8a") +
 labs(y = "Gdp growth in %", title = "Switzerland GDP growth in % (1971-2018)", caption = "Source: SKEMA Quantum Studio (WDI)") +
 theme_minimal()
```

```{r summary Switzerland GDP}
CHmeangdp <- summary(CHGDP$NY.GDP.MKTP.KD.ZG) 
CHmeangdp
```

As we can see on the graph, the *Switzerland* GDP growth is sometimes under 0, but the most of the time, it's higher than 0. To better understand these data, i have choosen to compute the mean (1,68) and the median (1,82) of the GDP growth on the period 1971 - 2018.
As we can see on the graphic, there is an **important decrease in 1975** due to the **first oil crisis**.

### *Comparison with three european countries (France, Italy and Germany)*

```{r compare countries GDP, include=FALSE}
comparecountries <-WDI(indicator = "NY.GDP.MKTP.KD.ZG",
country = c("CH", "DE", "FRA", "IT"),
                   start = 1971,
                   end = 2018)
```

```{r summary of the 4 countries}
library(dplyr)
comparecountries %>% group_by(country) %>% summarise(mean_gdp = mean(NY.GDP.MKTP.KD.ZG), max_gdp = max(NY.GDP.MKTP.KD.ZG), min_gdp = min(NY.GDP.MKTP.KD.ZG), median_gdp = median(NY.GDP.MKTP.KD.ZG))
```

As we can see, *Switzerland* doesn't have the best results in terms of the variation of his GDP. In fact, Switzerland has the **worst results compared to this others countries**.
It'll be interesting to understand why *Switzerland* has a better economy than these 3 countries even if the results about the variation of his gdp are less good than his neighbours.

## Analysis of the GDP per capita

```{r Switzerland GDP per capita, include=FALSE}
CHGdpPerCapita<- WDI(indicator = "NY.GDP.PCAP.PP.CD",
country = c("CH"),
                   start = 1990,  #the data start in 1990 for this information
                   end = 2018)
```

```{r Switzerland Gdp per capita evolution graphic, fig.align='center'}
ggplot(CHGdpPerCapita) +
 aes(x = year, y = NY.GDP.PCAP.PP.CD) +
 geom_line(size = 1L, colour = "#0c4c8a") +
 labs(y = "Gdp per capita", title = "Switzerland Gdp per capita evolution (in $ constant)", caption = "Source: SKEMA Quantum Studio (WDI)") +
 theme_minimal()
```

We can see that the GDP per capita increase during this period, he was at *27594.63 in 1990* and at *68060.94 in 2018* (**146,6% increase**). It'll be now interesting to compare with the three others countries to see if *Switzerland* is better in this category.

### *Comparison with three european countries (France, Italy and Germany)*

```{r Compare countries GDP per capita, include=FALSE}
GdpPerCapitaComparison <- WDI(indicator = "NY.GDP.PCAP.PP.CD",
country = c("CH", "DE", "FRA", "IT"),
                   start = 1990,
                   end = 2018)
```

```{r Comparison graphic about GDP per capita, fig.align='center'}
ggplot(GdpPerCapitaComparison) +
 aes(x = year, y = NY.GDP.PCAP.PP.CD, colour = country) +
 geom_line(size = 1L) +
 scale_color_hue() +
 labs(y = "GDP per capita", title = "Comparison GDP per capita", caption = "Source: SKEMA Quantum Studio (WDI)") +
 theme_minimal()
```

*Switzerland* seems to be *far away* from his neighbours regarding the gdp per capita. *Germany* is in the second place with 53074.54 in 2018 (**28% less than Switzerland**), France in the third place with 45342.40 in 2018 (**50% less than Switzerland**).
The conclusion of this analysis is that *Switzerland* is better when speaking about economic health into an **individual citizens perspective**.

## Consumer Price Index

The Consumer Price Index (CPI) is a measure of the average change over time in the prices paid by urban consumers for a market basket of consumer goods and services.

```{r Consumer Price Index, include=FALSE}
CPIc<- rdb(ids = c('BIS/long_cpi/A.CH.628', "BIS/long_cpi/A.FR.628", "BIS/long_cpi/A.IT.628", "BIS/long_cpi/A.DE.628")) %>%
  filter(!is.na(value))
CPIc <- rename(CPIc, Country = series_name) # Base 2010=100 (à inclure sur graphique)
```

```{r, fig.align='center'}
ggplot(CPIc, aes(x = period, y = value, color = Country)) +
  geom_line(size = 1) + 
  theme_dark() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "Consumer Price Index", title = "CPI comparison", caption = "Source: SKEMA Quantum Studio (BIS)")
```

The consumer price index is used to demonstrate the price changes experienced by consumers in a given country. We can see from this graph that *Switzerland* is the **best performer**, since its consumer price index is **lower** than that of the other three countries. Nevertheless, the indices of the other three countries are very close to Switzerland. This means that their price **stability is also good**.

## Switzerland's trade

```{r Merchandise exports to high-income economies, include=FALSE}
CHExports <- WDI(indicator = "TX.VAL.MRCH.HI.ZS", #Merchandise exports to high-income economies (% of total merchandise exports)
country = c("CH"),
                   start = 1971,
                   end = 2018)
```

```{r Merchandise exports to high-income economies graphic, fig.align='center'}
library(ggplot2)
ggplot(CHExports) +
 aes(x = year, y = TX.VAL.MRCH.HI.ZS) +
 geom_line(size = 1L, colour = "#0c4c8a") +
 labs(y = "Merchandise Exports", title = "Merchandise exports to high-income economies (% of total 
      merchandise exports)", caption = "Source: SKEMA Quantum Studio (WDI)") +
 theme_minimal()
```

We can see from this graph that *Switzerland* spends most of its exports to the high-income economies. This means that it offers products with *high added value*. Nevertheless, this trend has been *slightly declining* since the early 2000s. This indicates a **diversification** of *Switzerland*'s offer and a willingness to **reach new markets**.

```{r Merchandise imports from low- and middle-income economies, include=FALSE}
CHImports <- WDI(indicator = "TM.VAL.MRCH.OR.ZS", #Merchandise imports from low- and middle-income economies outside region (% of total merchandise imports)
country = c("CH"),
                   start = 1971,
                   end = 2018)
```

```{r Merchandise imports from low- and middle-income economies graphic, fig.align='center'}
library(ggplot2)
ggplot(CHImports) +
 aes(x = year, y = TM.VAL.MRCH.OR.ZS) +
 geom_line(size = 1L, colour = "#0c4c8b") +
 labs(y = "Imports from low_middle economies", title = "Merchandise imports from low- and middle-income economies", caption = "Source: SKEMA Quantum Studio (WDI)") +
 theme_minimal()
```

*Switzerland* imported little from low-income economies until the early 1990s. Since the 1990s, the **trend has been upward**. This is due to **globalisation** and also to the need to have access to products and raw materials at **low prices**. Thus, since 1990, imports from these economies have **quadrupled**.

### Comparison between imports and exports

```{r crossing board import export, include=FALSE}
library(dplyr)
ImportExport <- bind_cols(CHExports, CHImports)
```

```{r, include=FALSE}
base::colnames(ImportExport)[colnames(ImportExport)=="TX.VAL.MRCH.HI.ZS"] <- "ExportsToHighEconomies"
base::colnames(ImportExport)[colnames(ImportExport)=="TM.VAL.MRCH.OR.ZS"] <- "ImportsFromLowEconomies"
```


```{r, include=FALSE}
library(tidyr)

CHImportExport <- gather(data = ImportExport, key = TYPE, value = VAL, ExportsToHighEconomies, ImportsFromLowEconomies)
```

```{r Comparison graphic about imports and exports, fig.align='center'}
library(ggplot2)
ggplot(CHImportExport) +
 aes(x = year, y = VAL, colour = TYPE) +
 geom_line(size = 1L) +
  geom_vline(aes(xintercept = 2010), linetype=2, colour = "black", size = 1) +
  geom_vline(aes(xintercept = 2017), linetype=2, colour = "black", size = 1) +
 scale_color_hue() +
 labs(y = "In % of total trades", title = "Comparison about imports to high economies and 
      exports from low/middle economies ", caption = "Source: SKEMA Quantum Studio (WDI)") +
 theme_gray()
```

As said before, we can see that *Switzerland* imports a bit (19,24%) from low / middle economies in 2017 but this is **really increasing since 1990**. About the exports, Switzerland exports a lot to high-income economies (75,15%) in 2017 but this is **decreasing since 2010**.
As a conclusion, we can say that *Switzerland* tend to import more from low / middle economies but also to export more to these economies. However, the most of exports / imports of Switzerland are made with high-income economies but the **low / middle economies increase their parts during last decade**.

## Balance of payments

```{r, include=FALSE}
library(rdbnomics)
BalanceTransactionsC <- rdb(ids = c('AMECO/UBCA/CHE.1.0.0.0.UBCA', "AMECO/UBCA/FRA.1.0.0.0.UBCA", "AMECO/UBCA/ITA.1.0.0.0.UBCA", "AMECO/UBCA/DEU.1.0.0.0.UBCA")) %>%
  filter(!is.na(value))
BalanceTransactionsC <- rename(BalanceTransactionsC, country = series_name)
```

```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(plotly)
BalanceTransactionsCGraph <- ggplot(BalanceTransactionsC, aes(x = period, y = value, color = country)) +
  geom_line(size = 1) + 
  theme_dark() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "Balance transaction", title = "Balance on current transactions with the rest of the world", caption = "Source: SKEMA Quantum Studio (AMECO)")

BalanceTransactionsCGraph <- ggplotly(BalanceTransactionsCGraph) %>%
  layout(legend = list(orientation = "h", x = 0.4, y = -0.2))
BalanceTransactionsC1 <- htmltools::div(BalanceTransactionsCGraph, align="center" )  # Result is now an HTML object
htmltools::save_html( BalanceTransactionsC1, "BalanceTransaction.html" )
BalanceTransactionsC1
```

*Switzerland* has a positive balance of payments, which means that it **exports more than it imports**, and this is a sign of **good economic health**. It is interesting to note that the Swiss balance of payments has **remained positive since the 1970s** while the other three countries all posted negative balances at some point in the period 1970 - 2020. This demonstrates *Switzerland*'s **trade stability** over a long period of time.
However, in this graph, *Germany* has the best balance of payments since 2005. *France* is the only country with a negative balance of payments in 2020.


# **Main social indicators**

## How Switzerland deals with unemployment?

```{r Unemployment advanced education, include=FALSE}
CHUnemploymentadvancededucation <- WDI(indicator = "SL.UEM.ADVN.ZS", #Unemployment with advanced education (% of total labor force with advanced education)
country = c("CH"),
                   start = 1998,
                   end = 2018)
```

```{r Renaming column Advanced_Education, include=FALSE}
base::colnames(CHUnemploymentadvancededucation)[colnames(CHUnemploymentadvancededucation)=="SL.UEM.ADVN.ZS"] <- "Advanced_Education"
```


```{r Unemployment intermediate education, include=FALSE}
CHUnemploymentintermediateeducation <- WDI(indicator = "SL.UEM.INTM.ZS", #Unemployment with intermediate education (% of total labor force with intermediate education)
country = c("CH"),
                   start = 1998,
                   end = 2018)
```

```{r Renaming column Intermediate_Education, include=FALSE}
base::colnames(CHUnemploymentintermediateeducation)[colnames(CHUnemploymentintermediateeducation)=="SL.UEM.INTM.ZS"] <- "Intermediate_Education"
```


```{r Unemployment basic education, include=FALSE}
CHUnemploymentbasiceducation <- WDI(indicator = "SL.UEM.BASC.ZS", #Unemployment with basic education (% of total labor force with basic education)
country = c("CH"),
                   start = 1998,
                   end = 2018)
```

```{r Renaming column Basic_Education, include=FALSE}
base::colnames(CHUnemploymentbasiceducation)[colnames(CHUnemploymentbasiceducation)=="SL.UEM.BASC.ZS"] <- "Basic_Education"
```


```{r First left-join, include=FALSE}
library(dplyr)
CHjoin1 <- left_join(CHUnemploymentadvancededucation, CHUnemploymentintermediateeducation, by="year") 
```

```{r Second left-join, include=FALSE}
CHjoin2 <- left_join(CHjoin1, CHUnemploymentbasiceducation, by="year")
```

```{r Delete some columns, include=FALSE}
CHjoin2$iso2c.y <- NULL
CHjoin2$iso2c <-  NULL
CHjoin2$country.y <- NULL
CHjoin2$country <- NULL
```

```{r Re-arrange columns, include=FALSE}
CHjoin2 <- CHjoin2[c(1,2,4,3,5,6)]
```

```{r Graphic about unemployment rate by education level, warning=FALSE, fig.align='center'}
library(tidyr)

CHjoin2 <- gather(
  data = CHjoin2,
  key = TYPE,
  value = VAL,
  Advanced_Education, Intermediate_Education, Basic_Education)

library(ggplot2)

ggplot(
  CHjoin2,
  aes(x = year, y = VAL, color = TYPE)
) +
  labs(y = "Unemployment rate", title = "Unemployment rate by education level", caption = "Source: SKEMA Quantum Studio (WDI)") +
geom_line()
```

This graph shows the difference between the level of education and the related unemployment rate in *Switzerland.* Very logically, those with a higher level of education are at an advantage and those with a lower level of education are at a disadvantage.  It will now be interesting to compare these unemployment rates with those of three other European countries to see whether **Switzerland** is doing well in terms of managing unemployment or not.

### *Comparison with three european countries (France, Italy and Germany)*

```{r Unemployment with advanced education comparison, include=FALSE}
UAEcomparison<- WDI(indicator = "SL.UEM.ADVN.ZS", #Unemployment with advanced education (% of total labor force with advanced education)
country = c("CH", "DE", "FRA", "IT"),
                   start = 2000,
                   end = 2018)
```

```{r Renaming column Advanced_Education comparison, include=FALSE}
base::colnames(UAEcomparison)[colnames(UAEcomparison)=="SL.UEM.ADVN.ZS"] <- "Advanced_EducationC"
```

```{r Unemployment intermediate education comparison, include=FALSE}
UIEcomparison<- WDI(indicator = "SL.UEM.INTM.ZS", #Unemployment with intermediate education (% of total labor force with advanced education)
country = c("CH", "DE", "FRA", "IT"),
                   start = 2000,
                   end = 2018)
```

```{r Renaming column Intermediate_Education comparison, include=FALSE}
base::colnames(UIEcomparison)[colnames(UIEcomparison)=="SL.UEM.INTM.ZS"] <- "Intermediate_EducationC"
```

```{r Unemployment basic education comparison, include=FALSE}
UBEcomparison <- WDI(indicator = "SL.UEM.BASC.ZS", #Unemployment with basic education (% of total labor force with advanced education)
country = c("CH", "DE", "FRA", "IT"),
                   start = 2000,
                   end = 2018)
```

```{r Renaming column Basic_Education comparison, include=FALSE}
base::colnames(UBEcomparison)[colnames(UBEcomparison)=="SL.UEM.BASC.ZS"] <- "Basic_EducationC"
```

```{r Combining columns comparison, include=FALSE}
library(dplyr)
UCjoin <- bind_cols(UAEcomparison, UIEcomparison, UBEcomparison)
```

```{r Delete some columns comparison, include=FALSE}
UCjoin$iso2c <- NULL
UCjoin$iso2c1 <- NULL
UCjoin$country1 <- NULL
UCjoin$year1 <- NULL
UCjoin$iso2c2 <- NULL
UCjoin$country2 <- NULL
UCjoin$year2 <- NULL
```

```{r Re-arrange columns comparison, include=FALSE}
UCjoin <- UCjoin[c(1,3,2,4,5)]
```

```{r Gather data about unemployment comparison, include=FALSE}
library(tidyr)

UCjoinTest <- gather(data = UCjoin, key = TYPE, value = VAL, Advanced_EducationC, Intermediate_EducationC, Basic_EducationC)
```

```{r Graphic about unemployment rate by education level comparison, fig.align='center'}
qplot(data = UCjoinTest, y = VAL, x = year, color = TYPE, geom = "line") + 
  labs(y = "Unemployment rate in %", title = "Unemployment rate by education level", caption = "Source: SKEMA Quantum Studio (WDI)") +
  facet_wrap(~ country) +
  theme_linedraw()
```

As we can see from the graph, *Switzerland* has had a relatively stable unemployment rate since the early 2000s. An increase of about **2.2% in 18 years for those with a high or intermediate level of education** and an increase of about **3.8% for those with a low level of education**.
Only *Germany* is doing better than *Switzerland* in terms of unemployment at the end of 2018 for those with a high or intermediate level of education. Nevertheless, the gap remains small, **1.6% for the advanced education category** and **1.9% for the intermediate level**. *Switzerland* is doing better than *Germany* in terms of employability in the low education category, with a **0.7% gap** in favour of *Switzerland*.

In contrast, *France and Italy* are the worst performers, with unemployment rates for all education categories combined far higher than *Germany and Switzerland*. 
For example, the unemployment rate for the low and intermediate education categories is **twice as high** in *France* as in *Switzerland* in 2018.
*Italy* shows similar results to *France*.

Finally, it is interesting to note that *Germany* has seen its **unemployment rate fall since 2005**, *Switzerland* remains **stable**, while *France and Italy* have seen their **unemployment rates rise since 2006**, although there has been a **slight improvement over the last 5 years**.

## Social progress index

“The Social Progress Index is a new way to define the success of our societies. It is a comprehensive measure of real quality of life, independent of economic indicators. The Social Progress Index is designed to complement, rather than replace, economic measures such as GDP.” (The Social Progress Imperative, 2018)

```{r Library call, include=FALSE}
library(spiR)
library(kableExtra)
library(ggplot2)
library(dplyr)
```

```{r Generate SPI data, include=FALSE}
SPIc <- sqs_spi_data(country = c("CHE", "FRA", "DEU", "ITA"), 
                       year = c("2014","2015","2016", "2017", "2018", "2019"), 
                       indicators = "SPI")
```

```{r Convert value to numeric SPI, include=FALSE}
SPIc$value <- as.numeric(SPIc$value)
```

```{r Generate new board SPI, include=FALSE}
kable(SPIc)%>%
scroll_box(width = "100%", height = "200px")
```

```{r Generate SPI graphic, fig.align='center'}
ggplot(data = SPIc, aes(x = var_year, y = value, color = countryName)) + 
  geom_line() +
  theme_grey() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  labs(title = "Social Progress Index of 4 different european countries since 2014",
       x = "Years",
       y = "Social Progress Index Score",
       colour = "Countries",
       caption = "Source: SKEMA Quantum Studio (spiR)")
```

*Switzerland* is the country with the **highest rate of social progress**. This is a very good sign because, in addition to a very high GDP per capita, the social climate is also very positive (although the two are not related). However, the other three countries are also doing very well.

## Expenditure on education

```{r, include=FALSE}
ExpenditureEducationC <- WDI(indicator = "SE.XPD.TOTL.GD.ZS", #Government expenditure on education, total (% of GDP)
country = c("CH", "FRA", "DE", "ITA"),
                   start = 1996,
                   end = 2016)
ExpenditureEducationC <- dplyr::rename(ExpenditureEducationC, Government_Expenditure = SE.XPD.TOTL.GD.ZS)
```

```{r, include=FALSE}
GDPComparison <- WDI(indicator = "NY.GDP.MKTP.CD", #GDP
country = c("CH", "FRA", "DE", "ITA"),
                   start = 1996,
                   end = 2016)
GDPComparison <- dplyr::rename(GDPComparison, GDP = NY.GDP.MKTP.CD)
```

```{r, include=FALSE}
library(dplyr)
PlotEducationGDP <- bind_cols(ExpenditureEducationC, GDPComparison)
```

```{r message=FALSE, warning=FALSE}
library(plotly)
DynGraphPlotEducationGDP <- ggplot(PlotEducationGDP, aes(year, Government_Expenditure, color = country)) +
  geom_point(aes(size = GDP, frame = year)) +
  scale_x_log10() +
  hrbrthemes::theme_modern_rc() +
  labs(y = "Government Expenditure in % of GDP", title = "Expenditure on education in % of GDP")
DynGraphPlotEducationGDP <- ggplotly(DynGraphPlotEducationGDP)
DynGraphPlotEducationGDP 
```

As we can see between these four countries, *France* is the country that spends the most on education in relation to its GDP. *Switzerland* is in second place. It is interesting to note that France spends more on education but that nevertheless its **unemployment rate is much higher** than *Switzerland* (see previous graph). *Germany* is in third place, very close to *Switzerland*. *Italy* is the country that spends the least on education in relation to its GDP in all years. Finally, this graph highlights the fact that Switzerland is the country with the **lowest GDP** (among the 4 countries compared) but that it is the country with the **highest GDP per capita** (see previous graph). 
To conclude, we can deduce that *Switzerland's* expenditure on education is certainly **lower** than *France's*, but that graduates will **find work more easily** and will **benefit from higher salaries** (although this must be balanced with the **Consumer Price Index**).

## Foreign population

```{r, include=FALSE}
ForeignPopulation <- rdb(ids = c('OECD/MIG/TOTP.B15.TOT.CHE', "OECD/MIG/TOTP.B15.TOT.FRA", "OECD/MIG/TOTP.B15.TOT.ITA", "OECD/MIG/TOTP.B15.TOT.DEU")) %>%
  filter(!is.na(value))
```

```{r, include=FALSE}
ForeignPopulationPlot <- ggplot(ForeignPopulation, aes(x = period, y = value, color = Country)) +
  geom_line(size = 1) + 
  theme_light() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "Foreign population in % of total pop", title = "Stock of foreign population by nationality", caption = "Source: SKEMA Quantum Studio (OECD)")
```

```{r, include=FALSE}
library(grid)
my_text <- "Huge gap between Switzerland
and Germany"
my_grob = grid.text(my_text, x=0.7,  y=0.6, gp=gpar(col="black", fontsize=12, fontface="bold"))
```

```{r, fig.align='center'}
ForeignPopulationPlot + annotation_custom(my_grob)
```

*Switzerland* is a country that welcomes many foreigners, especially to **work**, as is the case for many French people interested in the **high salaries offered by this country**. 
*Switzerland* therefore has a much higher ratio of foreigners than its European neighbours. Moreover, this can be explained by the fact that it is **very complicated to be naturalized Swiss**. It is, for example, easier in *France.* Thus, once naturalized, the ratio tends to fall since the person no longer counts as a foreigner. These two factors explain why the ratio for *Switzerland* is so high.

## Intentional homicide ratio

```{r, include=FALSE}
CrimesComparison <- rdb(ids = c('Eurostat/crim_hom_soff/A.ICCS0101.PER_CNV.T.P_HTHAB.CH', "Eurostat/crim_hom_soff/A.ICCS0101.PER_CNV.T.P_HTHAB.FR", "Eurostat/crim_hom_soff/A.ICCS0101.PER_CNV.T.P_HTHAB.IT", "Eurostat/crim_hom_soff/A.ICCS0101.PER_CNV.T.P_HTHAB.DE")) %>%
  filter(!is.na(value))
CrimesComparison
```

```{r, include=FALSE}
base::colnames(CrimesComparison)[colnames(CrimesComparison)=="Geopolitical entity (reporting)"] <- "Country" 
```

```{r, include=FALSE}
CrimesComparisonPlot <- ggplot(CrimesComparison, aes(x = period, y = value, color = Country)) +
  geom_line(size = 1) + 
  theme_gray() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "Intentional homicide per 
       hundred thousand inhabitants", title = "Crimes stats", caption = "Source: SKEMA Quantum Studio (Eurostat)")
```

```{r, fig.align='center'}
CrimesComparisonPlot + theme(plot.title=element_text(size=20, 
                                    face="bold", 
                                    family="American Typewriter",
                                    color="#E81232",
                                    hjust=0.5,
                                    lineheight=1.2))
```

*Switzerland* is the country with the **lowest crime rate** (compared to France, Italy and Germany). Indeed, its ratio shows a homicide rate of **0.33 per 100,000 inhabitants**. This can be explained in part by the severity of the Swiss justice system but also by all the means put in place for the **well-being of citizens**. This is also why the country's Social Progress Index is so high. *Germany* is doing as well as *Switzerland* in terms of the rate of homicides committed, *France* has a ratio **twice** as high as *Switzerland* and *Italy* **three times** as high, however, their statistics are still **decent**.

## Risk of poverty or social exclusion

This indicator corresponds to the sum of persons who are: at risk of poverty after social transfers, severely materially deprived or living in households with very low work intensity. Persons are counted only once even if they are affected by more than one of these phenomena.
• Persons are considered to be at risk of poverty after social transfers, if they have an equivalised disposable income below the risk-of-poverty threshold, which is set at 60 % of the national median equivalised disposable income.
• Severely materially deprived persons have living conditions severely constrained by a lack of resources, they experience at least 4 out of 9 following deprivations items: cannot afford i) to pay rent or utility bills, ii) keep home adequately warm, iii) face unexpected expenses, iv) eat meat, fish or a protein equivalent every second day, v) a week holiday away from home, vi) a car, vii) a washing machine, viii) a colour TV, or ix) a telephone.
• People living in households with very low work intensity are those aged 0-59 living in households where the adults (aged 18-59) work 20% or less of their total work potential during the past year.**(Eurostat)**

```{r, include=FALSE}
PovertyComparison <- rdb(ids = c('Eurostat/ilc_peps01/A.PC.TOTAL.T.CH', "Eurostat/ilc_peps01/A.PC.TOTAL.T.IT", "Eurostat/ilc_peps01/A.PC.TOTAL.T.FR", "Eurostat/ilc_peps01/A.PC.TOTAL.T.DE")) %>%
  filter(!is.na(value))
```

```{r, include=FALSE}
base::colnames(PovertyComparison)[colnames(PovertyComparison)=="Geopolitical entity (reporting)"] <- "Country" 
```

```{r, fig.align='center'}
ggplot(PovertyComparison, aes(x = period, y = value, color = Country)) +
  geom_line(size = 1) + 
  theme_gray() +
  theme(legend.position="bottom") + 
   guides(col = guide_legend(nrow = 4)) +
  labs(y = "% at risk of poverty", title = "People at risk of poverty or social exclusion",      caption = "Source: SKEMA Quantum Studio (Eurostat)") +
  ggthemes::theme_stata()
```

As we can see, *Switzerland* is the country (on a par with *France*) in which the risk of becoming poor and/or socially excluded is the **lowest.** This is a very good social indicator because it shows that the country puts forward means to **fight against inequalities** but above all to prevent individuals from being in a situation of social isolation.

In 2017, 112.8 million people in the EU lived in households at risk of poverty or social exclusion; 22.4 % of the population. **(Eurostat)**


# **Main business indicators**

## Corruption Perceptions Index

The indicator is a composite index based on a combination of surveys and assessments of corruption from 13 different sources and scores and ranks countries based on how corrupt a country’s public sector is perceived to be, with a score of 0 representing a very high level of corruption and a score of 100 representing a very clean country.

```{r include=FALSE}
CorruptionIndex <- rdb(ids = c('Eurostat/sdg_16_50/A.NR.CH', "Eurostat/sdg_16_50/A.NR.FR", "Eurostat/sdg_16_50/A.NR.IT", "Eurostat/sdg_16_50/A.NR.DE")) %>%
  filter(!is.na(value))
```

```{r include=FALSE}
CorruptionIndex2019 <- filter(CorruptionIndex, original_period == 2019)
```

```{r include=FALSE}
base::colnames(CorruptionIndex2019)[colnames(CorruptionIndex2019)=="Geopolitical entity (reporting)"] <- "Country" 
```

```{r include=FALSE}
## Recoding CorruptionIndex2019$Country
CorruptionIndex2019$Country <- recode(CorruptionIndex2019$Country,
               "Germany (until 1990 former territory of the FRG)" = "Germany")
```

```{r, fig.align='center'}
ggplot(CorruptionIndex2019) +
 aes(x = Country, colour = Country, weight = value) +
 geom_bar(fill = "white") +
 scale_color_hue() +
 labs(y = "Value", title = "Corruption Perceptions Index", caption = "Source: SKEMA Quantum Studio (Eurostat)") +
 ggthemes::theme_stata()
```

The corruption index shows whether a country is reliable, especially for doing business there. It can be seen here that *Switzerland* has a corruption index of **85** (the highest of the 4 countries). This is a very good indication that the country is **very little affected by corruption**. Thus, potential investors can **invest serenely** in this country without the risk of seeing their funds disappear or having problems with a biased justice system.

## Swiss industries

```{r include=FALSE}
IndustryCH <- data.frame(Industry=c("Primary_Sector", "Secondary-Sector", "Tertiary_Sector"), NumberOfCompanies=c(8.98, 15.33, 75.69)) ## Office fédéral statistique Suisse, data 2017
IndustryCH$Industry <- as.character(IndustryCH$Industry)
```

```{r fig.align='center'}
pie = ggplot(IndustryCH, aes(x="", y=NumberOfCompanies, fill=Industry)) + geom_bar(stat="identity", width=1)
 
pie = pie + coord_polar("y", start=0) + geom_text(aes(label = paste0(round(NumberOfCompanies), "%")), position = position_stack(vjust = 0.5))
 
pie = pie + scale_fill_manual(values=c("#C77528", "#F09F27", "#3E7AC9")) 
 
pie = pie + labs(x = NULL, y = NULL, fill = NULL, title = "Switzerland Industries", caption = "Source: SKEMA Quantum Studio (Office fédéral statistique Suisse)")
 
pie = pie + theme_classic() + theme(axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank(),
          plot.title = element_text(hjust = 0.5, color = "black"))
pie
```

Nombre d'entreprises de chaque secteur dans l'ordre : 53010, 90483, 446760
ANALYSE À FAIRE

## Industries that export the most by sector

```{r}
SwitzerlandTopIndustries <- data.frame(Industry=c("Pharmaceuticals",
                                                  "Gems, precious metals",
                               "Machinery including computers","Organic chemicals",
                               "Clocks , watches including parts",
                               "Optical, technical, medical apparatus",
                               "Electrical machinery, equipment",
                               "Plastics, plastic articles","Perfumes, cosmetics",
                               "Articles of iron or steel"), ExportValue=c(83, 80.1, 22.9, 22, 21.8, 17.3, 12.6, 5.2, 3.7, 2.9) ## in billion $
)
```

```{r include=FALSE}
SwitzerlandTopIndustries1 <- ggplot(SwitzerlandTopIndustries) +
 aes(x = reorder(Industry, -ExportValue), fill = Industry, weight = ExportValue) +
 geom_bar() +
 scale_fill_hue() +
 coord_flip() +
  theme_grey() +
  labs(y = "Value in billion $", title = "Industries that export the most, in billion $", caption = "Source: SKEMA Quantum Studio (opendata.swiss)")
```

```{r fig.align='center'}
SwitzerlandTopIndustries1 + theme(legend.position='none', axis.title.y = element_blank(), axis.text.x = element_text(face="bold", color="black", size = 8), axis.text.y = element_text(color="black", face = "italic"), plot.title = element_text(face="bold", size = 12))
```

ANALYSE À FAIRE

## Penser à rajouter des données sur les industries suisses (finance, etc)

# **Conclusion**