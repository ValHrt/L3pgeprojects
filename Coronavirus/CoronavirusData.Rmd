---
title: "Coronavirus"
author: "Valentin Henriot"
date: "15/03/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(coronavirus)
```

```{r}
data("coronavirus")
```

```{r}
library(dplyr)

summary_df <- coronavirus %>% group_by(Country.Region, type) %>%
  summarise(total_cases = sum(cases)) %>%
  arrange(-total_cases)

summary_df %>% head(20)
```

```{r}
library(tidyr)

coronavirus %>% 
  filter(date == max(date)) %>%
  select(country = Country.Region, type, cases) %>%
  group_by(country, type) %>%
  summarise(total_cases = sum(cases)) %>%
  pivot_wider(names_from = type,
              values_from = total_cases) %>%
  arrange(-confirmed)
```

```{r}
CoronavirusFR <- filter(coronavirus, Country.Region == "France")
```

```{r}
CoronavirusFR2 <- filter(CoronavirusFR, Province.State == "France")
```

```{r}
library (ggplot2)
ggplot(CoronavirusFR2) +
 aes(x = date, fill = type, colour = type, weight = cases) +
 geom_bar() +
 scale_fill_hue() +
 scale_color_hue() +
 labs(y = "Nombre de cas", title = "Coronavirus en France", caption = "Source : Rami Krispin dataset coronavirus") +
 ggthemes::theme_stata()
```

```{r}
CoronavirusIT <- filter(coronavirus, Country.Region == "Italy")
```

```{r}
ggplot(CoronavirusIT) +
 aes(x = date, fill = type, colour = type, weight = cases) +
 geom_bar() +
 scale_fill_hue() +
 scale_color_hue() +
 labs(y = "Nombre de cas", title = "Coronavirus en Italie", caption = "Source : Rami Krispin dataset coronavirus") +
 ggthemes::theme_stata()
```

```{r}
CoronavirusDE <- filter(coronavirus, Country.Region == "Germany")
```

```{r}
ggplot(CoronavirusDE) +
 aes(x = date, fill = type, colour = type, weight = cases) +
 geom_bar() +
 scale_fill_hue() +
 scale_color_hue() +
 labs(y = "Nombre de cas", title = "Coronavirus en Allemagne", caption = "Source : Rami Krispin dataset coronavirus") +
 ggthemes::theme_stata()
```

```{r}
CoronavirusSPA <- filter(coronavirus, Country.Region == "Spain")
```

```{r}
ggplot(CoronavirusSPA) +
 aes(x = date, fill = type, colour = type, weight = cases) +
 geom_bar() +
 scale_fill_hue() +
 scale_color_hue() +
 labs(y = "Nombre de cas", title = "Coronavirus en Espagne", caption = "Source : Rami Krispin dataset coronavirus") +
 ggthemes::theme_stata()
```

```{r}
CombineCountries <- filter(coronavirus, Country.Region == "France" | Country.Region == "Spain" | Country.Region == "Germany" | Country.Region == "Italy")
```

```{r}
library(plotly)
CombineGraph <-ggplot(CombineCountries, aes(date, cases))

CombineGraph2 <- CombineGraph + geom_bar(stat = "identity", aes(fill = type)) +
  facet_wrap(~ Country.Region) +
  xlab("Date") + 
  ggtitle("Cas de coronavirus") +
  theme_linedraw()

CombineGraph3 <- CombineGraph2 + theme(axis.title.y = element_blank()) 

CombineGraph3 <- ggplotly(CombineGraph3)
CombineGraph3
```

```{r}
DataCountries <- CombineCountries %>% group_by(Country.Region, type) %>%
  summarise(total_cases = sum(cases)) %>%
  arrange(Country.Region)
```

```{r}
DataCountries2 <- spread(DataCountries, "type", "total_cases")
```

```{r}
DataCountries2$confirmed <- as.numeric(DataCountries2$confirmed)
DataCountries2$death <- as.numeric(DataCountries2$death)
DataCountries2$recovered <- as.numeric(DataCountries2$recovered)
```

```{r}
DataCountries2$"Ratio death/confirmed" <- DataCountries2$death/DataCountries2$confirmed*100
```

```{r}
library(kableExtra)
kable(DataCountries2) %>%
  kable_styling("striped", full_width = F) %>%
  column_spec(3, bold = T) %>%
  row_spec(1, bold = T, color = "white", background = "blue") %>%
  row_spec(2, bold = T, color = "white", background = "red") %>%
  row_spec(3, bold = T, color = "white", background = "green") %>%
  row_spec(4, bold = T, color = "white", background = "orange")
```

```{r}
library(rdbnomics)
HospitalEmployment <- rdb(ids = c('Eurostat/hlth_rs_prshp1/A.HOSP.HC_HTHAB.IT', "Eurostat/hlth_rs_prshp1/A.HOSP.HC_HTHAB.FR", "Eurostat/hlth_rs_prshp1/A.HOSP.HC_HTHAB.ES", "Eurostat/hlth_rs_prshp1/A.HOSP.HC_HTHAB.DE")) %>%
  filter(!is.na(value)) # Annual – Hospital employment – Head count per hundred thousand inhabitants
```

```{r}
HospitalEmployment2017 <- filter(HospitalEmployment, original_period == 2017)
```

```{r include=FALSE}
base::colnames(HospitalEmployment2017)[colnames(HospitalEmployment2017)=="Geopolitical entity (reporting)"] <- "Country" 
```

```{r include=FALSE}
HospitalEmployment2017$Country <- recode(HospitalEmployment2017$Country,
               "Germany (until 1990 former territory of the FRG)" = "Germany")
```

```{r}
ggplot(HospitalEmployment2017) +
 aes(x = Country, fill = Country, weight = value) +
 geom_bar() +
 scale_fill_hue() +
 labs(x = "Pays", y = "Ratio pour 100.000 habitants", title = "Nombre d'employés dans les hôpitaux pour 100.000 habitants", caption = "Source : Eurostat (2017)") +
 ggthemes::theme_pander()
```

```{r}
HospitalBeds <- rdb(ids = c('Eurostat/hlth_rs_bds/A.P_HTHAB.HBEDT.FR', "Eurostat/hlth_rs_bds/A.P_HTHAB.HBEDT.IT", "Eurostat/hlth_rs_bds/A.P_HTHAB.HBEDT.ES", "Eurostat/hlth_rs_bds/A.P_HTHAB.HBEDT.DE")) %>%
  filter(!is.na(value)) # Annual – Per hundred thousand inhabitants – Available beds in hospitals 
```

```{r}
HospitalBeds2017 <- filter(HospitalBeds, original_period == 2017)
```

```{r include=FALSE}
base::colnames(HospitalBeds2017)[colnames(HospitalBeds2017)=="Geopolitical entity (reporting)"] <- "Country" 
```

```{r include=FALSE}
HospitalBeds2017$Country <- recode(HospitalBeds2017$Country,
               "Germany (until 1990 former territory of the FRG)" = "Germany")
```

```{r}
ggplot(HospitalBeds2017) +
 aes(x = Country, fill = Country, weight = value) +
 geom_bar() +
 scale_fill_hue() +
 labs(y = "Ratio pour 100.000 habitants", title = "Lits d'hôpitaux pour 100.000 habitants", caption = "Source : Eurostat (2017)") +
 ggthemes::theme_pander()
```

